{"cells":[{"cell_type":"code","source":["pip install pyodbc"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"r22CtURwlQEj","executionInfo":{"status":"ok","timestamp":1721050235824,"user_tz":-120,"elapsed":8252,"user":{"displayName":"David","userId":"13024953833381166534"}},"outputId":"e5422bac-f32a-4743-9d4b-d5fe75a42e3e"},"id":"r22CtURwlQEj","execution_count":7,"outputs":[{"output_type":"stream","name":"stdout","text":["Requirement already satisfied: pyodbc in /usr/local/lib/python3.10/dist-packages (5.1.0)\n"]}]},{"cell_type":"markdown","id":"c7e2a36a-baad-4070-a727-cecb42550265","metadata":{"id":"c7e2a36a-baad-4070-a727-cecb42550265"},"source":["## Visualización"]},{"cell_type":"code","execution_count":8,"id":"d060d35a-11bf-4722-b343-a0474e73c64a","metadata":{"id":"d060d35a-11bf-4722-b343-a0474e73c64a","executionInfo":{"status":"ok","timestamp":1721050235824,"user_tz":-120,"elapsed":19,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":["import pandas as pd\n","import seaborn as sns\n","import matplotlib.pyplot as plt"]},{"cell_type":"markdown","id":"fbffc5b6-0642-44d3-8439-d6ec47b4ea2f","metadata":{"id":"fbffc5b6-0642-44d3-8439-d6ec47b4ea2f"},"source":["### Ejercicio 1\n","Establece una conexión con la base de datos AdventureWorks2022 y muestra los primeros 3 registros de la tabla `HumanResources.Employee`"]},{"cell_type":"code","execution_count":9,"id":"bea1941e-5763-4258-939d-573c0d3df914","metadata":{"colab":{"base_uri":"https://localhost:8080/","height":211},"id":"bea1941e-5763-4258-939d-573c0d3df914","executionInfo":{"status":"error","timestamp":1721050235824,"user_tz":-120,"elapsed":18,"user":{"displayName":"David","userId":"13024953833381166534"}},"outputId":"c7d86982-6788-4d60-b935-b1f06a968451"},"outputs":[{"output_type":"error","ename":"Error","evalue":"('01000', \"[01000] [unixODBC][Driver Manager]Can't open lib 'SQL Server' : file not found (0) (SQLDriverConnect)\")","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mError\u001b[0m                                     Traceback (most recent call last)","\u001b[0;32m<ipython-input-9-26ba43158660>\u001b[0m in \u001b[0;36m<cell line: 2>\u001b[0;34m()\u001b[0m\n\u001b[1;32m      1\u001b[0m \u001b[0;32mimport\u001b[0m \u001b[0mpyodbc\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m----> 2\u001b[0;31m conn = pyodbc.connect(\n\u001b[0m\u001b[1;32m      3\u001b[0m     \u001b[0;34m'DRIVER={SQL Server};SERVER={217.160.32.109};DATABASE={AdventureWorks2022};UID={neoland_admin};PWD={1234}'\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      4\u001b[0m )\n\u001b[1;32m      5\u001b[0m \u001b[0mcursor\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mconn\u001b[0m\u001b[0;34m.\u001b[0m\u001b[0mcursor\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;31mError\u001b[0m: ('01000', \"[01000] [unixODBC][Driver Manager]Can't open lib 'SQL Server' : file not found (0) (SQLDriverConnect)\")"]}],"source":["import pyodbc\n","conn = pyodbc.connect(\n","    'DRIVER={SQL Server};SERVER={217.160.32.109};DATABASE={AdventureWorks2022};UID={neoland_admin};PWD={1234}'\n",")\n","cursor = conn.cursor()\n","cursor.execute(\"SELECT * FROM HumanResources.Employee\")\n","rows = cursor.fetchall()\n","df = pd.DataFrame.from_records(rows, columns=[column[0] for column in cursor.description])"]},{"cell_type":"markdown","id":"517f5ed9-dc9e-4fa8-a5ff-d9b2fbc6b4fc","metadata":{"id":"517f5ed9-dc9e-4fa8-a5ff-d9b2fbc6b4fc"},"source":["### Ejercicio 2\n","De la tabla `HumanResources.Employee` mostrar la cantidad de empleados por `MaritalStatus` en un gráfico de barras"]},{"cell_type":"code","execution_count":null,"id":"2bcc45ea-89c8-4ffd-a2b9-aafbde2dc097","metadata":{"id":"2bcc45ea-89c8-4ffd-a2b9-aafbde2dc097","executionInfo":{"status":"aborted","timestamp":1721050235825,"user_tz":-120,"elapsed":18,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":["df1 = df.\\\n","    groupby('MaritalStatus').\\\n","    agg({'BusinessEntityID':'count'}).\\\n","    reset_index()"]},{"cell_type":"code","execution_count":null,"id":"9538f42c-f05c-47da-b4e2-a47a97097f18","metadata":{"id":"9538f42c-f05c-47da-b4e2-a47a97097f18","executionInfo":{"status":"aborted","timestamp":1721050235825,"user_tz":-120,"elapsed":18,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":["df1.columns"]},{"cell_type":"code","execution_count":null,"id":"c2a18715-7414-4747-91b4-4f000ebefa47","metadata":{"id":"c2a18715-7414-4747-91b4-4f000ebefa47","executionInfo":{"status":"aborted","timestamp":1721050235825,"user_tz":-120,"elapsed":18,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":["pl"]},{"cell_type":"code","execution_count":null,"id":"554656e3-6323-45b5-9cf6-127ff05a0a51","metadata":{"id":"554656e3-6323-45b5-9cf6-127ff05a0a51","executionInfo":{"status":"aborted","timestamp":1721050235826,"user_tz":-120,"elapsed":19,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":["sns.barplot(x = df1.MaritalStatus, y = df1.BusinessEntityID)"]},{"cell_type":"markdown","id":"6af88636-1370-48e1-a295-ef74ddb7eff2","metadata":{"id":"6af88636-1370-48e1-a295-ef74ddb7eff2"},"source":["### Ejercicio 3\n","De la tabla `HumanResources.Employee` mostrar la cantidad de empleados por `MaritalStatus` en un gráfico de barras. Mostrar una barra por cada `Gender`"]},{"cell_type":"code","execution_count":null,"id":"7445ca45-07fb-4b82-bce4-844b7a6101a0","metadata":{"id":"7445ca45-07fb-4b82-bce4-844b7a6101a0","executionInfo":{"status":"aborted","timestamp":1721050235826,"user_tz":-120,"elapsed":19,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":["df1 = df.\\\n","    groupby(['MaritalStatus', 'Gender']).\\\n","    agg({'BusinessEntityID':'count'}).\\\n","    reset_index()\n","sns.barplot(x = df1.MaritalStatus, y = df1.BusinessEntityID, hue = df1.Gender)\n","plt.show()"]},{"cell_type":"markdown","id":"0fec547b-bdc4-467f-8df9-4db846a70662","metadata":{"id":"0fec547b-bdc4-467f-8df9-4db846a70662"},"source":["### Ejercicio 4\n","De la tabla `Sales.SalesOrderHeader` mostrar el total de ventas (`TotalDue`) mensuales (`OrderDate`)en un gráfico de líneas.\n","\n","Puede ser de utilidad leer sobre el módulo `dt` dentro de pandas, en particular:\n","* el método `dt.to_period()` para extraer el mes de la venta (https://pandas.pydata.org/docs/reference/api/pandas.Series.dt.to_period.html)\n","* el método `dt.to_timestamp()` para convertir el resultado anterior en una fecha (https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.to_timestamp.html#pandas.DataFrame.to_timestamp)"]},{"cell_type":"code","execution_count":null,"id":"33940bbd-9b5b-456b-85a1-97a3854751b8","metadata":{"id":"33940bbd-9b5b-456b-85a1-97a3854751b8","executionInfo":{"status":"aborted","timestamp":1721050235827,"user_tz":-120,"elapsed":20,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":["tabla = pd.read_csv(\"SalesOrderHeader.csv\")\n","tabla.head(5)"]},{"cell_type":"code","execution_count":null,"id":"7065cafb-5488-4962-be54-b59e688c22a3","metadata":{"id":"7065cafb-5488-4962-be54-b59e688c22a3","executionInfo":{"status":"aborted","timestamp":1721050235828,"user_tz":-120,"elapsed":21,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":["cursor.execute(\"SELECT * FROM Sales.SalesOrderHeader\")\n","rows = cursor.fetchall()\n","df = pd.DataFrame.from_records(\n","    rows,\n","    columns=[column[0] for column in cursor.description]\n",")\n"]},{"cell_type":"code","execution_count":null,"id":"df1e5a54-af88-47c1-9e3c-87c59899c512","metadata":{"id":"df1e5a54-af88-47c1-9e3c-87c59899c512","executionInfo":{"status":"aborted","timestamp":1721050235828,"user_tz":-120,"elapsed":21,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":["cursor.execute(\"\\\n","    SELECT * FROM Sales.SalesOrderHeader\\\n","    LEFT JOIN Tabla As algo\\\n","    ON \")\n","rows = cursor.fetchall()\n","df = pd.DataFrame.from_records(\n","    rows,\n","    columns=[column[0] for column in cursor.description]\n",")\n","df[\"AñoMes\"] = df[\"OrderDate\"].dt.to_period(\"M\")\n","\n","df1 = df.\\\n","    groupby(['AñoMes']).\\\n","    agg({'TotalDue':'sum'}).\\\n","    reset_index()\n","df1.head()\n","\n","plt.plot_date(\n","    df1.AñoMes,\n","    df1.TotalDue,\n","    \"*--b\"\n",")\n","plt.xticks(rotation = 90)\n","plt.show()"]},{"cell_type":"code","execution_count":null,"id":"cc6c5b4f-9c7a-4051-a4fc-7d49050ae867","metadata":{"id":"cc6c5b4f-9c7a-4051-a4fc-7d49050ae867","executionInfo":{"status":"aborted","timestamp":1721050235828,"user_tz":-120,"elapsed":20,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":["df[\"OrderDate\"].dt.month_name()"]},{"cell_type":"code","execution_count":null,"id":"5ac146df-b0fe-4577-a23b-5506d4edc61e","metadata":{"id":"5ac146df-b0fe-4577-a23b-5506d4edc61e","executionInfo":{"status":"aborted","timestamp":1721050235828,"user_tz":-120,"elapsed":20,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":["df[\"AñoMes\"] = df[\"OrderDate\"].dt.to_period(\"M\")"]},{"cell_type":"code","execution_count":null,"id":"7a9df4a9-99ec-4ebc-8e7d-6841a2545d0e","metadata":{"id":"7a9df4a9-99ec-4ebc-8e7d-6841a2545d0e","executionInfo":{"status":"aborted","timestamp":1721050235829,"user_tz":-120,"elapsed":20,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":["#df['OrderDate'] = df.OrderDate.dt.to_period('M').dt.to_timestamp()"]},{"cell_type":"code","execution_count":null,"id":"9225c2aa-43ff-4584-8857-e5234a7bf0f2","metadata":{"id":"9225c2aa-43ff-4584-8857-e5234a7bf0f2","executionInfo":{"status":"aborted","timestamp":1721050235829,"user_tz":-120,"elapsed":20,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":["df1 = df.\\\n","    groupby(['AñoMes']).\\\n","    agg({'TotalDue':'sum'}).\\\n","    reset_index()\n","df1.head()"]},{"cell_type":"code","execution_count":null,"id":"97df2156-4dcb-433c-8d83-95aace918b36","metadata":{"id":"97df2156-4dcb-433c-8d83-95aace918b36","executionInfo":{"status":"aborted","timestamp":1721050235829,"user_tz":-120,"elapsed":20,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":["plt.plot_date(\n","    df1.AñoMes,\n","    df1.TotalDue,\n","    \"*--b\"\n",")\n","plt.xticks(rotation = 90)\n","plt.show()"]},{"cell_type":"code","execution_count":null,"id":"da1268d1-196f-4c52-bed8-1cceaca1fbbf","metadata":{"id":"da1268d1-196f-4c52-bed8-1cceaca1fbbf","executionInfo":{"status":"aborted","timestamp":1721050235829,"user_tz":-120,"elapsed":19,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":[]},{"cell_type":"code","execution_count":null,"id":"d2faf5d1-2aae-48aa-8e66-c95d6d8f390e","metadata":{"id":"d2faf5d1-2aae-48aa-8e66-c95d6d8f390e","executionInfo":{"status":"aborted","timestamp":1721050235829,"user_tz":-120,"elapsed":18,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":[]},{"cell_type":"code","execution_count":null,"id":"ea57a0a9-5c3c-4eff-b7d5-79d91febbcb0","metadata":{"id":"ea57a0a9-5c3c-4eff-b7d5-79d91febbcb0","executionInfo":{"status":"aborted","timestamp":1721050235829,"user_tz":-120,"elapsed":17,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":["df1 = df.\\\n","    groupby(['OrderDate']).\\\n","    agg({'TotalDue':'sum'}).\\\n","    reset_index()\n","\n","sns.lineplot(\n","    x = df1.OrderDate,\n","    y = df1.TotalDue,\n",")\n","\n","plt.xticks(rotation = 45)\n","\n","plt.show()"]},{"cell_type":"code","execution_count":null,"id":"a036a7e0-29e1-4d41-827b-796a5a5045f1","metadata":{"id":"a036a7e0-29e1-4d41-827b-796a5a5045f1","executionInfo":{"status":"aborted","timestamp":1721050235829,"user_tz":-120,"elapsed":17,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":[]},{"cell_type":"markdown","id":"ac51671f-66b7-4ce4-a01c-02c918ab166d","metadata":{"id":"ac51671f-66b7-4ce4-a01c-02c918ab166d"},"source":["### Ejercicio 5\n","De la tabla `Production.Product` mostrar un histograma con los precios de lista de los productos (`ListPrice`). No deben ser tenidos en cuenta los productos con precio de lista igual a cero."]},{"cell_type":"code","execution_count":null,"id":"2af6d88c-83a9-45fd-a619-83f0394f7511","metadata":{"id":"2af6d88c-83a9-45fd-a619-83f0394f7511","executionInfo":{"status":"aborted","timestamp":1721050235829,"user_tz":-120,"elapsed":17,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":["cursor.execute(\"SELECT * FROM Production.Product\")\n","rows = cursor.fetchall()\n","df = pd.DataFrame.from_records(rows, columns=[column[0] for column in cursor.description])\n"]},{"cell_type":"code","execution_count":null,"id":"7ad9e637-aced-4bbb-a6ca-ed85f39a81bb","metadata":{"id":"7ad9e637-aced-4bbb-a6ca-ed85f39a81bb","executionInfo":{"status":"aborted","timestamp":1721050235829,"user_tz":-120,"elapsed":16,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":["sns.histplot(data = df[df.ListPrice>0], x = 'ListPrice', color = 'c',)"]},{"cell_type":"markdown","id":"1192816b-8c9d-4f11-a012-280c1e6ed421","metadata":{"id":"1192816b-8c9d-4f11-a012-280c1e6ed421"},"source":["### Ejercicio 6\n","De la tabla `Production.Product` mostrar un histograma con los precios de lista de los productos (`ListPrice`). No deben ser tenidos en cuenta los productos con precio de lista igual a cero.\n","\n","Además tiene que verse el detalle por categoría de producto"]},{"cell_type":"code","execution_count":null,"id":"d5eeda71-75c8-4c95-a9d9-d7a0bda0eb12","metadata":{"id":"d5eeda71-75c8-4c95-a9d9-d7a0bda0eb12","executionInfo":{"status":"aborted","timestamp":1721050235829,"user_tz":-120,"elapsed":16,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":["cursor.execute(\"\\\n","    SELECT product.*, category.Name AS Categoria \\\n","    FROM Production.Product product\\\n","    LEFT JOIN Production.ProductSubcategory subcategory\\\n","    ON subcategory.ProductSubcategoryID = product.ProductSubcategoryID\\\n","    LEFT JOIN Production.ProductCategory category\\\n","    ON subcategory.ProductCategoryID = category.ProductCategoryID\")\n","rows = cursor.fetchall()\n","df = pd.DataFrame.from_records(rows, columns=[column[0] for column in cursor.description])\n","df.to_csv(\"Productos_completo.csv\")"]},{"cell_type":"code","execution_count":null,"id":"6c3816f7-f56e-4b3b-b635-338330013a1c","metadata":{"id":"6c3816f7-f56e-4b3b-b635-338330013a1c","executionInfo":{"status":"aborted","timestamp":1721050235830,"user_tz":-120,"elapsed":17,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":["df.shape"]},{"cell_type":"code","execution_count":null,"id":"dfa2c122-425a-4d6f-ac98-02a227e6ee1b","metadata":{"id":"dfa2c122-425a-4d6f-ac98-02a227e6ee1b","executionInfo":{"status":"aborted","timestamp":1721050235830,"user_tz":-120,"elapsed":17,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":["df.Categoria = df.Categoria.replace({None: 'Sin Categoria'})"]},{"cell_type":"code","execution_count":null,"id":"255b3230-d88c-4b69-8834-562a93b6d7fc","metadata":{"id":"255b3230-d88c-4b69-8834-562a93b6d7fc","executionInfo":{"status":"aborted","timestamp":1721050235830,"user_tz":-120,"elapsed":17,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":["sns.histplot(data = df[df.ListPrice>0], x = 'ListPrice',hue='Categoria', multiple='stack')"]},{"cell_type":"code","execution_count":null,"id":"ab988510-b014-49b3-af27-d7123ee1e311","metadata":{"id":"ab988510-b014-49b3-af27-d7123ee1e311","executionInfo":{"status":"aborted","timestamp":1721050235830,"user_tz":-120,"elapsed":16,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":["cantidad = df.groupby(\"MaritalStatus\").size()\n","\n","plt.bar(\n","    x = cantidad.index,\n","    height = cantidad.values\n",")"]},{"cell_type":"code","execution_count":null,"id":"585a4abe-05bc-41ae-84da-e21cc4ceefe2","metadata":{"id":"585a4abe-05bc-41ae-84da-e21cc4ceefe2","executionInfo":{"status":"aborted","timestamp":1721050235830,"user_tz":-120,"elapsed":16,"user":{"displayName":"David","userId":"13024953833381166534"}}},"outputs":[],"source":["cantidad = df.groupby('MaritalStatus').agg({'BusinessEntityID':'count'}).reset_index()\n","cantidad\n","\n","plt.bar(\n","    x = cantidad[\"MaritalStatus\"],\n","    height = cantidad[\"BusinessEntityID\"]\n",")"]}],"metadata":{"kernelspec":{"display_name":"Python 3 (ipykernel)","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.11.7"},"colab":{"provenance":[]}},"nbformat":4,"nbformat_minor":5}